{#
/**
 * @file
 * Theme override for displaying a view as a Carbon Data Table.
 *
 * Available variables:
 * - attributes: Remaining HTML attributes for the element.
 * - title : The title of this group of rows.
 * - header: The table header columns.
 * - caption_needed: Is the caption tag needed.
 * - caption: The caption for this table.
 * - rows: Table row items. Rows are keyed by row number.
 * - responsive: A flag indicating whether table is responsive.
 * - sticky: A flag indicating whether table header is sticky.
 *
 * @see template_preprocess_views_view_table()
 */
#}

{# Build columns array from Views header #}
{% set columns = [] %}
{% for key, column in header %}
  {% set columns = columns|merge([{
    key: key,
    header: column.content,
    sortable: column.url ? true : false,
  }]) %}
{% endfor %}

{# Build rows array from Views rows #}
{% set table_rows = [] %}
{% for row in rows %}
  {% set row_data = {} %}
  {% for key, column in row.columns %}
    {# Extract the actual content from the column #}
    {% set cell_content %}
      {% if column.wrapper_element %}
        {% for content in column.content %}
          {{ content.field_output }}
        {% endfor %}
      {% else %}
        {% for content in column.content %}
          {{ content.field_output }}
        {% endfor %}
      {% endif %}
    {% endset %}
    {% set row_data = row_data|merge({(key): cell_content|striptags|trim}) %}
  {% endfor %}
  {% set table_rows = table_rows|merge([row_data]) %}
{% endfor %}

{{ include('carbon_design_system:datatable', {
  title: caption ?: title,
  columns: columns,
  rows: table_rows,
  useZebraStyles: true,
  isSortable: true,
  stickyHeader: sticky,
  size: 'lg',
  attributes: attributes,
}) }}
